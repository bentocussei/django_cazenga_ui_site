
{% load icon_tags %}

{% block page_title %}Input OTP{% endblock %}
{% block page_description %}Campos de entrada para códigos de verificação e autenticação{% endblock %}

{% block component_content %}
<div class="max-w-4xl mx-auto space-y-8">
    <!-- Instalação -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Instalação</h2>
        <div class="relative">
            <pre class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto"><code>{% templatetag openblock %} include "components/input-otp.html" with name="otp" length=6 type="numeric" {% templatetag closeblock %}</code></pre>
            <button 
                class="absolute top-2 right-2 p-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                x-data="{ copied: false }"
                @click="navigator.clipboard.writeText($el.previousElementSibling.textContent); copied = true; setTimeout(() => copied = false, 2000)"
            >
                <span x-show="!copied">{% icon "copy" size="4" %}</span>
                <span x-show="copied" class="text-green-600">{% icon "check" size="4" %}</span>
            </button>
        </div>
    </section>

    <!-- Input OTP Básico -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Input OTP Básico</h2>
        <div class="border rounded-lg p-6">
            <div class="space-y-4">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    Campo básico para inserção de código de verificação de 6 dígitos
                </div>
                <div class="max-w-md mx-auto" x-data="{
                    otp: ['', '', '', '', '', ''],
                    activeIndex: 0,
                    handleInput(event, index) {
                        const value = event.target.value;
                        if (value.length > 1) {
                            // Colar múltiplos caracteres
                            const chars = value.split('').slice(0, 6);
                            chars.forEach((char, i) => {
                                if (index + i < 6) {
                                    this.otp[index + i] = char;
                                }
                            });
                            this.focusNext(Math.min(index + chars.length - 1, 5));
                        } else {
                            this.otp[index] = value;
                            if (value && index < 5) {
                                this.focusNext(index + 1);
                            }
                        }
                    },
                    handleKeydown(event, index) {
                        if (event.key === 'Backspace' && !this.otp[index] && index > 0) {
                            this.focusNext(index - 1);
                        } else if (event.key === 'ArrowLeft' && index > 0) {
                            this.focusNext(index - 1);
                        } else if (event.key === 'ArrowRight' && index < 5) {
                            this.focusNext(index + 1);
                        }
                    },
                    focusNext(index) {
                        this.activeIndex = index;
                        this.$nextTick(() => {
                            this.$refs['input' + index].focus();
                        });
                    },
                    clear() {
                        this.otp = ['', '', '', '', '', ''];
                        this.focusNext(0);
                    },
                    get otpValue() {
                        return this.otp.join('');
                    }
                }">
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 text-center">
                            Digite o código de verificação
                        </label>
                        
                        <div class="flex justify-center space-x-2">
                            <template x-for="(digit, index) in otp" :key="index">
                                <input 
                                    :x-ref="'input' + index"
                                    type="text" 
                                    maxlength="6"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    @keydown="handleKeydown($event, index)"
                                    @focus="activeIndex = index"
                                    :class="{ 'ring-2 ring-blue-500': activeIndex === index }"
                                    class="w-12 h-12 text-center text-lg font-semibold border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                                    autocomplete="one-time-code"
                                    inputmode="numeric"
                                    pattern="[0-9]*"
                                >
                            </template>
                        </div>
                        
                        <div class="text-center space-y-2">
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                Código inserido: <span class="font-mono font-semibold" x-text="otpValue || 'Nenhum'"></span>
                            </div>
                            <button @click="clear()" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                                Limpar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="relative">
            <pre class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto text-sm"><code>&lt;div x-data="{ otp: ['', '', '', '', '', ''], activeIndex: 0 }"&gt;
    &lt;div class="flex justify-center space-x-2"&gt;
        &lt;template x-for="(digit, index) in otp"&gt;
            &lt;input 
                type="text" 
                maxlength="1"
                :value="digit"
                @input="handleInput($event, index)"
                @keydown="handleKeydown($event, index)"
                class="w-12 h-12 text-center border rounded-lg focus:ring-2 focus:ring-blue-500"
                autocomplete="one-time-code"
                inputmode="numeric"
            &gt;
        &lt;/template&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
            <button 
                class="absolute top-2 right-2 p-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                x-data="{ copied: false }"
                @click="navigator.clipboard.writeText($el.previousElementSibling.textContent); copied = true; setTimeout(() => copied = false, 2000)"
            >
                <span x-show="!copied">{% icon "copy" size="4" %}</span>
                <span x-show="copied" class="text-green-600">{% icon "check" size="4" %}</span>
            </button>
        </div>
    </section>

    <!-- Diferentes Tamanhos -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Diferentes Tamanhos</h2>
        <div class="border rounded-lg p-6">
            <div class="space-y-6">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    Códigos de diferentes comprimentos para diferentes necessidades
                </div>
                
                <!-- PIN de 4 dígitos -->
                <div class="space-y-3">
                    <h3 class="text-md font-medium">PIN de 4 dígitos</h3>
                    <div class="max-w-xs mx-auto" x-data="{
                        pin: ['', '', '', ''],
                        handleInput(event, index) {
                            const value = event.target.value.slice(-1);
                            this.pin[index] = value;
                            if (value && index < 3) {
                                this.$refs['pin' + (index + 1)].focus();
                            }
                        },
                        handleKeydown(event, index) {
                            if (event.key === 'Backspace' && !this.pin[index] && index > 0) {
                                this.$refs['pin' + (index - 1)].focus();
                            }
                        }
                    }">
                        <div class="flex justify-center space-x-2">
                            <template x-for="(digit, index) in pin" :key="index">
                                <input 
                                    :x-ref="'pin' + index"
                                    type="password" 
                                    maxlength="1"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    @keydown="handleKeydown($event, index)"
                                    class="w-10 h-10 text-center text-lg font-bold border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    inputmode="numeric"
                                    pattern="[0-9]*"
                                >
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Código de 8 caracteres alphanumerico -->
                <div class="space-y-3">
                    <h3 class="text-md font-medium">Código de backup (8 caracteres)</h3>
                    <div class="max-w-lg mx-auto" x-data="{
                        backup: ['', '', '', '', '', '', '', ''],
                        handleInput(event, index) {
                            const value = event.target.value.slice(-1).toUpperCase();
                            if (/^[A-Z0-9]$/.test(value) || value === '') {
                                this.backup[index] = value;
                                if (value && index < 7) {
                                    this.$refs['backup' + (index + 1)].focus();
                                }
                            }
                        },
                        handleKeydown(event, index) {
                            if (event.key === 'Backspace' && !this.backup[index] && index > 0) {
                                this.$refs['backup' + (index - 1)].focus();
                            }
                        }
                    }">
                        <div class="flex justify-center space-x-1">
                            <template x-for="(char, index) in backup" :key="index">
                                <div>
                                    <input 
                                        :x-ref="'backup' + index"
                                        type="text" 
                                        maxlength="1"
                                        :value="char"
                                        @input="handleInput($event, index)"
                                        @keydown="handleKeydown($event, index)"
                                        class="w-8 h-10 text-center text-sm font-mono font-semibold border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="·"
                                    >
                                    <div x-show="index === 3" class="inline-block w-2"></div>
                                </div>
                            </template>
                        </div>
                        <div class="text-center mt-2 text-xs text-gray-500 dark:text-gray-400">
                            Use apenas letras e números
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Com Separadores -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Com Separadores</h2>
        <div class="border rounded-lg p-6">
            <div class="space-y-4">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    Códigos com separadores visuais para melhor legibilidade
                </div>
                
                <div class="max-w-md mx-auto" x-data="{
                    code: ['', '', '', '', '', ''],
                    handleInput(event, index) {
                        const value = event.target.value.slice(-1);
                        this.code[index] = value;
                        if (value && index < 5) {
                            this.$refs['code' + (index + 1)].focus();
                        }
                    },
                    handleKeydown(event, index) {
                        if (event.key === 'Backspace' && !this.code[index] && index > 0) {
                            this.$refs['code' + (index - 1)].focus();
                        }
                    }
                }">
                    <div class="flex justify-center items-center space-x-2">
                        <template x-for="(digit, index) in code" :key="index">
                            <div class="flex items-center">
                                <input 
                                    :x-ref="'code' + index"
                                    type="text" 
                                    maxlength="1"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    @keydown="handleKeydown($event, index)"
                                    class="w-12 h-12 text-center text-lg font-semibold border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    inputmode="numeric"
                                    pattern="[0-9]*"
                                >
                                <div x-show="index === 2" class="mx-2 text-gray-400">-</div>
                            </div>
                        </template>
                    </div>
                    <div class="text-center mt-3 text-sm text-gray-600 dark:text-gray-400">
                        Formato: XXX-XXX
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Com Validação -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Com Validação</h2>
        <div class="border rounded-lg p-6">
            <div class="space-y-4">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    Input OTP com validação em tempo real e feedback visual
                </div>
                
                <div class="max-w-md mx-auto" x-data="{
                    otp: ['', '', '', '', '', ''],
                    isValid: false,
                    isSubmitted: false,
                    correctCode: '123456',
                    remainingTime: 30,
                    canResend: false,
                    timer: null,
                    init() {
                        this.startTimer();
                    },
                    handleInput(event, index) {
                        const value = event.target.value.slice(-1);
                        if (/^[0-9]$/.test(value) || value === '') {
                            this.otp[index] = value;
                            if (value && index < 5) {
                                this.$refs['otp' + (index + 1)].focus();
                            }
                            this.validateOtp();
                        }
                    },
                    handleKeydown(event, index) {
                        if (event.key === 'Backspace' && !this.otp[index] && index > 0) {
                            this.$refs['otp' + (index - 1)].focus();
                        }
                    },
                    validateOtp() {
                        const code = this.otp.join('');
                        this.isValid = code.length === 6;
                        
                        if (this.isValid) {
                            setTimeout(() => {
                                this.isSubmitted = true;
                                if (code === this.correctCode) {
                                    this.showSuccess();
                                } else {
                                    this.showError();
                                }
                            }, 500);
                        }
                    },
                    showSuccess() {
                        // Feedback de sucesso
                    },
                    showError() {
                        this.otp = ['', '', '', '', '', ''];
                        this.isSubmitted = false;
                        this.isValid = false;
                        this.$refs.otp0.focus();
                    },
                    startTimer() {
                        this.timer = setInterval(() => {
                            if (this.remainingTime > 0) {
                                this.remainingTime--;
                            } else {
                                this.canResend = true;
                                clearInterval(this.timer);
                            }
                        }, 1000);
                    },
                    resendCode() {
                        this.remainingTime = 30;
                        this.canResend = false;
                        this.otp = ['', '', '', '', '', ''];
                        this.isSubmitted = false;
                        this.isValid = false;
                        this.startTimer();
                        this.$refs.otp0.focus();
                    }
                }">
                    <div class="space-y-4">
                        <div class="text-center">
                            <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">Verificação de Segurança</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                Digite o código de 6 dígitos enviado para seu telefone
                            </p>
                        </div>
                        
                        <div class="flex justify-center space-x-2">
                            <template x-for="(digit, index) in otp" :key="index">
                                <input 
                                    :x-ref="'otp' + index"
                                    type="text" 
                                    maxlength="1"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    @keydown="handleKeydown($event, index)"
                                    :class="{
                                        'border-green-500 bg-green-50 dark:bg-green-900/20': isSubmitted && otp.join('') === correctCode,
                                        'border-red-500 bg-red-50 dark:bg-red-900/20': isSubmitted && otp.join('') !== correctCode,
                                        'border-blue-500': !isSubmitted && digit !== ''
                                    }"
                                    class="w-12 h-12 text-center text-lg font-semibold border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                                    inputmode="numeric"
                                    pattern="[0-9]*"
                                >
                            </template>
                        </div>
                        
                        <div class="text-center space-y-2">
                            <div x-show="isSubmitted && otp.join('') === correctCode" class="text-green-600 dark:text-green-400 text-sm flex items-center justify-center space-x-1">
                                {% icon "check-circled" size="4" %}
                                <span>Código verificado com sucesso!</span>
                            </div>
                            
                            <div x-show="isSubmitted && otp.join('') !== correctCode" class="text-red-600 dark:text-red-400 text-sm flex items-center justify-center space-x-1">
                                {% icon "cross-circled" size="4" %}
                                <span>Código incorreto. Tente novamente.</span>
                            </div>
                            
                            <div x-show="!canResend" class="text-sm text-gray-600 dark:text-gray-400">
                                Reenviar código em <span class="font-mono" x-text="remainingTime"></span>s
                            </div>
                            
                            <button x-show="canResend" @click="resendCode()" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">
                                Reenviar código
                            </button>
                        </div>
                        
                        <div class="text-center text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-2 rounded">
                            <strong>Dica para teste:</strong> Use o código 123456
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Estilos Customizados -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Estilos Customizados</h2>
        <div class="border rounded-lg p-6">
            <div class="space-y-6">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    Diferentes estilos visuais para o Input OTP
                </div>
                
                <!-- Estilo Underline -->
                <div class="space-y-3">
                    <h3 class="text-md font-medium">Estilo Underline</h3>
                    <div class="max-w-sm mx-auto" x-data="{
                        code: ['', '', '', '', '', ''],
                        handleInput(event, index) {
                            const value = event.target.value.slice(-1);
                            this.code[index] = value;
                            if (value && index < 5) {
                                this.$refs['under' + (index + 1)].focus();
                            }
                        }
                    }">
                        <div class="flex justify-center space-x-4">
                            <template x-for="(digit, index) in code" :key="index">
                                <input 
                                    :x-ref="'under' + index"
                                    type="text" 
                                    maxlength="1"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    class="w-10 h-12 text-center text-xl font-bold bg-transparent border-0 border-b-2 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 focus:outline-none focus:border-blue-500 transition-colors"
                                    inputmode="numeric"
                                >
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Estilo Círculo -->
                <div class="space-y-3">
                    <h3 class="text-md font-medium">Estilo Círculo</h3>
                    <div class="max-w-sm mx-auto" x-data="{
                        code: ['', '', '', '', '', ''],
                        handleInput(event, index) {
                            const value = event.target.value.slice(-1);
                            this.code[index] = value;
                            if (value && index < 5) {
                                this.$refs['circle' + (index + 1)].focus();
                            }
                        }
                    }">
                        <div class="flex justify-center space-x-3">
                            <template x-for="(digit, index) in code" :key="index">
                                <input 
                                    :x-ref="'circle' + index"
                                    type="text" 
                                    maxlength="1"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    class="w-12 h-12 text-center text-lg font-bold border-2 border-gray-300 dark:border-gray-600 rounded-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 transition-all"
                                    inputmode="numeric"
                                >
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- Estilo Preenchido -->
                <div class="space-y-3">
                    <h3 class="text-md font-medium">Estilo Preenchido</h3>
                    <div class="max-w-sm mx-auto" x-data="{
                        code: ['', '', '', '', '', ''],
                        handleInput(event, index) {
                            const value = event.target.value.slice(-1);
                            this.code[index] = value;
                            if (value && index < 5) {
                                this.$refs['filled' + (index + 1)].focus();
                            }
                        }
                    }">
                        <div class="flex justify-center space-x-2">
                            <template x-for="(digit, index) in code" :key="index">
                                <input 
                                    :x-ref="'filled' + index"
                                    type="text" 
                                    maxlength="1"
                                    :value="digit"
                                    @input="handleInput($event, index)"
                                    :class="{ 'bg-blue-100 dark:bg-blue-900 border-blue-500': digit !== '' }"
                                    class="w-12 h-12 text-center text-lg font-bold border border-transparent rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:bg-blue-50 dark:focus:bg-blue-900/50 focus:border-blue-500 transition-all"
                                    inputmode="numeric"
                                >
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Parâmetros -->
    <section class="space-y-4">
        <h2 class="text-2xl font-semibold">Parâmetros</h2>
        <div class="border rounded-lg overflow-hidden">
            <table class="w-full">
                <thead class="bg-gray-50 dark:bg-gray-800">
                    <tr>
                        {% for header in input_otp_params.headers %}
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            {{ header }}
                        </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
                    {% for row in input_otp_params.data %}
                    <tr>
                        {% for cell in row %}
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">
                            {{ cell|safe }}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %} 